name: 'Vercel Repository Dispatch - Debug'
description: 'Debug action for Vercel repository dispatch deployment events. Useful for viewing the full payload from the event.'

runs:
  using: 'composite'
  steps:
    - name: Debug Client Payload
      shell: bash
      run: |
        echo "ğŸ” Debugging Vercel Repository Dispatch Client Payload"
        echo ""

        # Check if this is a repository_dispatch event
        if [[ "${{ github.event_name }}" != "repository_dispatch" ]]; then
          echo "âŒ This action is designed for repository_dispatch events only."
          echo "ğŸ“‹ Current event type: ${{ github.event_name }}"
          exit 0
        fi

        echo "âœ… Event type: ${{ github.event_name }}"
        echo ""

        # Output the full client payload in a collapsible section
        echo "::group::ğŸ“¦ Full Client Payload (Click to expand)"
        echo '${{ toJSON(github.event.client_payload) }}'
        echo "::endgroup::"
        echo ""

        # Output individual fields with emoji prefixes
        echo "::group::ğŸ—ï¸ Project Information"
        echo "ğŸ“ Project Name: ${{ github.event.client_payload.project.name || 'N/A' }}"
        echo "ğŸ†” Project ID: ${{ github.event.client_payload.project.id || 'N/A' }}"
        echo "::endgroup::"
        echo ""

        echo "::group::ğŸŒ Environment"
        echo "ğŸŒ± Environment: ${{ github.event.client_payload.environment || 'N/A' }}"
        echo "::endgroup::"
        echo ""

        echo "::group::ğŸ“š Git Information"
        echo "ğŸŒ¿ Git Ref: ${{ github.event.client_payload.git.ref || 'N/A' }}"
        echo "ğŸ”— Git SHA: ${{ github.event.client_payload.git.sha || 'N/A' }}"
        echo "âœ‚ï¸ Short SHA: ${{ github.event.client_payload.git.shortSha || 'N/A' }}"
        echo "::endgroup::"
        echo ""

        echo "::group::ğŸš€ Deployment Information"
        echo "ğŸŒ Deployment URL: ${{ github.event.client_payload.url || 'N/A' }}"
        echo "ğŸ†” Deployment ID: ${{ github.event.client_payload.id || 'N/A' }}"
        echo "::endgroup::"
        echo ""

        echo "::group::ğŸ“Š State Information"
        echo "ğŸ“ˆ State Type: ${{ github.event.client_payload.state.type || 'N/A' }}"
        echo "ğŸ“‹ State Detail: ${{ github.event.client_payload.state.detail || 'N/A' }}"
        echo "::endgroup::"
        echo ""

        # Check for error information
        if [[ -n "${{ github.event.client_payload.error }}" ]]; then
          echo "::group::âŒ Error Information"
          echo "ğŸ’¥ Error: ${{ github.event.client_payload.error }}"
          echo "::endgroup::"
          echo ""
        fi

        echo "ğŸ‰ Debug output complete!"
